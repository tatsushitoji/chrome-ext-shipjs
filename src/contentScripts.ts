console.log("merge-button-for-shipjs script start");

const isPullRequest = (pathname: string) => pathname.includes("/pull/");
const generatedByShipjs = (text: string) =>
  text.includes(
    'automatically generated by <a href="https://github.com/algolia/shipjs">Ship.js</a>'
  );

window.addEventListener("load", () => {
  const { pathname } = window.location;
  const lastCommentInnerHTML = document.querySelector(".comment-body")
    .lastElementChild.innerHTML;

  // Pull Requestã§ãªã„å ´åˆã€ãªã«ã‚‚ã—ãªã„
  if (!isPullRequest(pathname)) {
    return;
  }

  // TODO: åˆ¥ã®åˆ¤æ–­åŸºæº–ã‚’è€ƒãˆãŸã„
  // Ship.jsã§ä½œæˆã•ã‚ŒãŸã¨åˆ¤æ–­ã§ããªã„å ´åˆã€ãªã«ã‚‚ã—ãªã„
  if (!generatedByShipjs(lastCommentInnerHTML)) {
    return;
  }

  // Squash and mergeã‚’é¸æŠçŠ¶æ…‹ã«å¤‰æ›´ã™ã‚‹
  const mergePrContainer = document.querySelector(".merge-pr");
  mergePrContainer.classList.remove("is-merging");
  mergePrContainer.classList.remove("is-rebasing");
  mergePrContainer.classList.add("is-squashing");

  // TODO https://github.com/tatsushitoji/merge-button-for-shipjs/issues/1
  // ä»–ã®mergeæ–¹æ³•ã‚’é¸ã¹ãªãã—ã¦ãŠã(.details-resetã‚’è¡¨ç¤ºã•ã›ãªã„)
  mergePrContainer.classList.add("hide-details-reset");

  // Squash and mergeãƒœã‚¿ãƒ³ã®æ•´å½¢
  const squashAndMergeButton = document.querySelector(".btn-group-squash");
  // è§’ä¸¸ã®èª¿æ•´
  squashAndMergeButton.classList.remove("rounded-left-1");
  squashAndMergeButton.classList.add("rounded");

  // ãƒ©ãƒ™ãƒ«ã«ã€Œand :passenger_ship: ã€ã‚’ã¤ã‘ã‚‹( ğŸ›³ï¸ ã§ã„ã‘ã‚‹ã‹ã¡ã‚‡ã£ã¨å¿ƒé…ã§ã¯ã‚ã‚‹ã‚‚ã®ã®node-emojiãªã©ã‚’ä½¿ã„ãŸããªã„)
  squashAndMergeButton.innerHTML = `${squashAndMergeButton.innerHTML} and ğŸ›³ï¸ `;
});
